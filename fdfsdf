import React, { useState } from "react";
import Data from "@data/sections/devis.json";
import Image from "next/image";
import emailjs from 'emailjs-com';

const TeamSection = () => {
  const [nom, setNom] = useState('');
  const [email, setEmail] = useState('');
  const [tel, setTel] = useState('');
  const [sujet, setSujet] = useState('');
  const [fille, setFille] = useState(null);

    const handleImageUpload = async (e) => {
      const file = e.target.files[0];
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', 'ml_default');
      try {
        const response = await fetch('https://api.cloudinary.com/v1_1/dzpd450fk/image/upload', {
          method: 'POST',
          body: formData,
        });
        const data = await response.json();
        setFille(data.secure_url);
      } catch (error) {
        console.error('Error uploading image:', error);
      }
    };
    
    
    const handleSubmit = async (e) => {
      e.preventDefault();
    
      const serviceId = 'service_ole5bjd';
      const templateId = 'template_z5fgqom';
    
      try {
        const emailData = {
          nom: nom,
          tel: tel,
          email: email,
          sujet: sujet,
          fille: fille, 
        };
    
        const response = await emailjs.send(serviceId, templateId, emailData, 'bTzzJi5rNKmrkV_0h');
    
        console.log('Email sent successfully!', response);
    
        setNom('');
        setEmail('');
        setTel('');
        setSujet('');
        setFille(null);
      } catch (error) {
        console.error('Error sending email:', error);
      }
    };
    

  return (
    <>
      <section className="bg-contact py-5">
        <div className="container">
          <div className="row items-center">
            <div className="col-lg-6">
              <div className="devis-img">
                <Image
                  src={Data.image.url}
                  alt={Data.image.alt}
                  width={500}
                  height={500}
                  className="mil-scale"
                  data-value-1="1"
                  data-value-2="1.2"
                />
              </div>
            </div>
            <div className="col-lg-6 py-4">
              <h1 className="text-center mb-5 text-black text-3xl font-bold">
                Demander votre devis gratuitement
              </h1>
              <div className="bg-white flex flex-1 flex-col justify-center px-2 py-3 lg:px-2 rounded-xl border-0">
                <div className="mt-3 mb-3 sm:mx-auto sm:w-full sm:max-w-sm">
                  <form className="space-y-6" onSubmit={handleSubmit}>
                    <div className="mt-2">
                      <input
                        id="nom"
                        name="nom"
                        placeholder="Nom Complet"
                        value={nom}
                        onChange={(e) => setNom(e.target.value)}
                        required
                        className="block w-full rounded-md border-0 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-[#ff5733] sm:text-sm sm:leading-6"
                      />
                    </div>
                    <div className="mt-2">
                      <input
                        id="tel"
                        name="tel"
                        type="tel"
                        required
                        value={tel}
                        onChange={(e) => setTel(e.target.value)}
                        placeholder="Téléphone"
                        className="block w-full rounded-md border-0 px-2 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-[#ff5733] sm:text-sm sm:leading-6"
                      />
                    </div>
                    <div className="mt-2">
                      <input
                        id="email"
                        name="email"
                        type="email"
                        autoComplete="email"
                        required
                        placeholder="Email"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        className="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-[#ff5733] sm:text-sm sm:leading-6"
                      />
                    </div>
                    <div className="mt-2">
                      <input
                        id="sujet"
                        name="sujet"
                        type="text"
                        required
                        value={sujet}
                        onChange={(e) => setSujet(e.target.value)}
                        placeholder="Sujet"
                        className="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-[#ff5733] sm:text-sm sm:leading-6 pl-2"
                      />
                    </div>
                    <div className="mt-2">
                      <input
                        className="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-[#ff5733] sm:text-sm sm:leading-6 pt-3"
                        type="file" id="file" name="file"
                        onChange={handleImageUpload} 
                      />
                    </div>
                    <div>
                      <button
                        type="submit"
                        className="flex w-full justify-center rounded-md bg-[#0FB9B6] hover:bg-[#0FB9B6] px-3 py-3 text-2xl font-semibold leading-6 text-black shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-600"
                      >
                        ENVOYER
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </>
  );
};

export default TeamSection;
